unless ENV['JOHNSON_FFI']

  Autotest.add_hook(:initialize) do |at|
    at.clear_mappings
    at.find_directories = %w(lib test)

    at.add_exception("test/helper.rb")

    at.add_mapping(/^lib\/.*\.rb$/) do |file, _|
      at.files_matching(/^test\/.*_test\.rb$/)
    end

    at.add_mapping(/^test\/.*_test\.rb$/) do |file, _|
      file
    end
  end

else

  Autotest.add_hook(:initialize) do |at|
    at.clear_mappings
    at.find_directories = %w(lib test)

    at.add_exception("test/helper.rb")

    at.add_mapping(/^lib\/johnson\/spidermonkey\/ffi\/.*\.rb$/) do |file, _|
      at.files_matching(/^test\/johnson\/spidermonkey\/ffi\/.*_test\.rb$/)
    end

    at.add_mapping(/^test\/johnson\/spidermonkey\/ffi\/.*_test\.rb$/) do |file, _|
      file
    end

  end

end
